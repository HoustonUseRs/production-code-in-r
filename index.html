<!DOCTYPE html><html><head><meta charset="utf8"/><title>Production Code in R</title><link rel="stylesheet" href="//houstonusers.github.io/production-code-in-r/css/global.css"/><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro|Merriweather:400,300,700,900,300italic,400italic,700italic,900italic|Raleway:400,900,800,700,600,500,300,200,100"/><script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/4.2.1/lodash.min.js"></script><script src="//houstonusers.github.io/production-code-in-r/js/main.js"></script></head><body><header><nav role="navigation" class="navbar navbar-default navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><button data-toggle="collapse" data-target="#navbar-top-collapse-1" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="//houstonusers.github.io/production-code-in-r/" class="navbar-brand">Production Code in R</a></div><div id="navbar-top-collapse-1" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.meetup.com/houstonr/events/227950604/">Meetup</a></li><li><a href="https://houstonusers.github.io/">About Us</a></li><li><a href="https://hrug.slack.com">Slack</a></li></ul></div></div></nav></header><main><div class="container-fluid"><div class="row"><div class="col-sm-2"><ul class="nav nav-pills nav-stacked nav-docs fixed"><li class="active"><a href="//houstonusers.github.io/production-code-in-r/">Notes</a><ul class="nav nav-pills nav-stacked"></ul></li></ul></div><div class="col-sm-10"><article class="article-docs"><h1>Production ready R</h1><ul>
<li>How do you write robust, readable code<ul>
<li>Programming<ul>
<li>local, function-level</li>
</ul>
</li>
<li>Software engineering<ul>
<li>global, project-level</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>how to write analysis that can run again and again</strong></p>
<h1>Programming</h1><ul>
<li><strong>Principle</strong> -- less outside context needed = clearer code<pre><code>baz &lt;- foo(bar, qux)
</code></pre><pre><code>df2 &lt;- arrange(df, qux)
</code></pre></li>
</ul>
<h2>Naming of variables and functions</h2><ul>
<li>programming is both about talking to computers and talking to people</li>
<li>collaboration with future you/others</li>
</ul>
<h2>Some potential gotchas</h2><pre><code>  df[, vars]  # type unstable -- you have to know if vars if one or multiple, could get dataframe or vector
  filter(df, x==y) # non-standard -- silent incorrect results
  data.frame(x = &quot;a&quot;) # data frame with one column, value depends on some global value
</code></pre><h2>3 classes of surprises</h2><ul>
<li>unstable types, non-standard evalution, hidden arguments</li>
</ul>
<pre><code>df &lt;- data.frame(
  a = 1L,
  b = 1.S,
  y = Sys.time(),
  z = ordered(1)
)

str(sapply(df[1:4], class)) # vector
str(sapply(df[1:2], class))
str(sapply(df[3:4], class)) # matrix
str(sapply(df[0], class))
</code></pre><p><strong>functions that always succeed are always the most dangerous</strong>
use <a href="https://github.com/hadley/purrr">purrr</a></p>
<pre><code>library(purrr)
</code></pre><p>type of output should not depend on input</p>
<h2>non-standard</h2><p>because of how r handles scoping?</p>
<ul>
<li>functions should fail early if there&#39;s a problem</li>
<li>specify/make it explicit</li>
</ul>
<h2>offenders of hidden arguments</h2><ul>
<li><code>stringAsFactors</code> - causes weird effects</li>
<li>system language</li>
<li>time zone</li>
<li>default text encoding</li>
<li>line endings</li>
<li><code>na.action</code></li>
</ul>
<p>-- warnPartialMatchArgs, warnPartialMatchAttr, warnPartialMatchDollar</p>
<p>dplyr is stricter</p>
<p>&quot;At the heart of R, theres a tension ...trying to be helpful and guess at what you want? or a programming language where it should fail early and make you aware of problems&quot;</p>
<p>Question: dataframe in dplyr
dply dataframe overrides print and subsetting, ignores drop=FALSE</p>
<h1>Software engineering</h1><p>&quot;I&#39;ve never done a data analysis in production...some things I think and some things friends have told me&quot;</p>
<h2>&quot;In Production&quot;</h2><ul>
<li>not just a static report</li>
<li>when you&#39;re running it again and again</li>
<li>kinda like reproducible research<ul>
<li>timescale is different, more often</li>
</ul>
</li>
</ul>
<h2>Isolation</h2><ul>
<li>different projects depending on different versions of packages</li>
<li>libraries vs. packages<ul>
<li>package is one package</li>
<li>library is a collection of packages</li>
</ul>
</li>
<li>isolate dependencies</li>
<li><a href="https://rstudio.github.io/packrat/"><code>packrat</code></a><ul>
<li>saves packages and versions to a text file</li>
<li>others can re-install packages easily</li>
</ul>
</li>
<li>Microsoft <a href="https://mran.revolutionanalytics.com/documents/rro/reproducibility/#timemachine"><code>checkpoint</code></a><ul>
<li>checkpoint dependent on daily snapshots of CRAN</li>
</ul>
</li>
<li>Renv for specifying versions of R</li>
</ul>
<h2>Verification</h2><ul>
<li>automate things</li>
<li>Use knitr/rmarkdown</li>
<li>use <code>git</code><ul>
<li>check diff before checking in</li>
</ul>
</li>
<li><a href="https://stat545-ubc.github.io/bit006_github-browsability-wins.html#get-over-your-hang-ups-re-committing-derived-products">commit derived files</a> so that you can verify your changes</li>
<li>tests for fragile analysis paths<ul>
<li>assertr, etc.</li>
</ul>
</li>
</ul>
<h2>Documentation</h2><ul>
<li>rmarkdown/knitr<ul>
<li>The <a href="http://deanattali.com/2015/03/24/knitrs-best-hidden-gem-spin/"><code>spin</code></a> function is useful<ul>
<li>Where code is the main focus, and markdown is in comments for code</li>
</ul>
</li>
</ul>
</li>
<li>rStudio connect <a href="https://www.rstudio.com/rstudio-connect-beta/">beta</a> -- publish and share within company</li>
</ul>
<h2>Other things to consider</h2><ul>
<li>Continuous integration?</li>
<li>Build automation?<ul>
<li>make files</li>
</ul>
</li>
</ul>
<h1>Questions</h1><ul>
<li><p>rmarkdown in oxygen?</p>
<ul>
<li><a href="https://github.com/klutometis/roxygen/pull/431">Pending</a></li>
</ul>
</li>
<li><p>Recommended interactive plot?</p>
<ul>
<li>Shiny</li>
<li>What about standalone?<ul>
<li>Doesn&#39;t plan on writing a standalone -- not dependent on a server running R -- charting lib</li>
<li>Currently -- <a href="http://ramnathv.github.io/rCharts/">rCharts</a></li>
</ul>
</li>
</ul>
</li>
<li><p>What signs to look for whether or not to use a package?</p>
<ul>
<li>look for tests</li>
<li>documentation</li>
<li>check out source code a little bit</li>
</ul>
</li>
<li><p>Out of your packages, which one to contribute to -- good for people trying to get into open source and need a little bit love?</p>
<ul>
<li>look at issues<ul>
<li>make <strong>simplest reproducible</strong> examples</li>
<li><a href="reprex">https://github.com/jennybc/reprex</a> helps you use rmarkdown to post on GitHub and StackOverflow</li>
<li><a href="How to make a great r reproducible example">http://stackoverflow.com/questions/5963269/how-to-make-a-great-r-reproducible-example/5965451#5965451</a></li>
<li>examples<ul>
<li><a href="https://github.com/hadley/dplyr/issues/1556">too complex</a></li>
<li><a href="https://github.com/hadley/dplyr/issues/1669">simpler</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://github.com/hadley/readr">readr</a> is in need of attention</li>
<li>tend to focus in on one R package at a time<ul>
<li><a href="https://github.com/hadley/dplyr">dplyr</a> is next after finishing book -- <a href="http://r4ds.had.co.nz/">draft here</a></li>
</ul>
</li>
<li>tends to cut off the world when he&#39;s trying to dig into stuff</li>
</ul>
</li>
<li><p>Credentials, where should they go? best practice</p>
<ul>
<li>set things in environment variables</li>
<li><code>.Renviron</code></li>
<li>don&#39;t check in the credentials to the web</li>
<li>thing to watch: <a href="https://github.com/MangoTheCat/keyring">https://github.com/MangoTheCat/keyring</a></li>
</ul>
</li>
</ul>
<h1>Rapidfire questions</h1><ul>
<li><p>proudest package</p>
<ul>
<li>ggplot2</li>
</ul>
</li>
<li><p>hardest to maintain</p>
<ul>
<li>ggplot2, dependencies, rcommand?</li>
</ul>
</li>
<li><p>best hangout in Houston</p>
<ul>
<li>double trouble</li>
</ul>
</li>
<li><p>Red Sox or Astros</p>
<ul>
<li>neither</li>
</ul>
</li>
<li><p>beach or mountain</p>
<ul>
<li>beach</li>
</ul>
</li>
<li><p>why r vs. python?</p>
<ul>
<li>ggplot2, r community, shiny, RStudio</li>
</ul>
</li>
<li><p>what would you like to change?</p>
<ul>
<li>nothing within my power to change</li>
</ul>
</li>
</ul>
</article></div></div></div></main><footer><a href="https://github.com/houstonusers/production-code-in-r">Github</a></footer></body></html>